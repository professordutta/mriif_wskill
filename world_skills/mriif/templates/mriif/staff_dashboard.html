{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Dashboard - NSDC World Skills Academy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Include navbar -->
    {% include 'mriif/navbar.html' %}
    {% include 'mriif/messages.html' %}

    <div class="container mx-auto px-4 py-8">
        <div class="flex flex-wrap -mx-4">
            <!-- Sidebar -->
            <div class="w-full md:w-1/4 px-4 mb-8">
                <div class="bg-white rounded-lg shadow-md p-6 sticky top-8">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">Staff Dashboard</h2>
                    
                    <nav class="space-y-3">
                        <button class="tab-btn w-full flex items-center p-3 text-left rounded-lg hover:bg-blue-50 focus:outline-none transition-colors" data-tab="overview">
                            <i class="fas fa-chart-pie text-blue-600 w-5 mr-3"></i>
                            <span>Overview</span>
                        </button>
                        <button class="tab-btn w-full flex items-center p-3 text-left rounded-lg hover:bg-blue-50 focus:outline-none transition-colors" data-tab="contacts">
                            <i class="fas fa-envelope text-blue-600 w-5 mr-3"></i>
                            <span>Contact Submissions</span>
                        </button>
                        <button class="tab-btn w-full flex items-center p-3 text-left rounded-lg hover:bg-blue-50 focus:outline-none transition-colors" data-tab="applications">
                            <i class="fas fa-graduation-cap text-blue-600 w-5 mr-3"></i>
                            <span>Course Applications</span>
                        </button>
                    </nav>
                    
                    <!-- Search and filters -->
                    <div class="mt-8 pt-6 border-t border-gray-200">
                        <h3 class="text-sm font-semibold text-gray-600 mb-4">Filters & Search</h3>
                        
                        <form method="GET" action="{% url 'staff_dashboard' %}">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">Search</label>
                                    <input type="text" name="search" value="{{ search_query }}" placeholder="Name, Email, etc." class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">From Date</label>
                                    <input type="date" name="date_from" value="{{ date_from }}" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
                                </div>
                                
                                <div>
                                    <label class="block text-sm text-gray-600 mb-1">To Date</label>
                                    <input type="date" name="date_to" value="{{ date_to }}" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
                                </div>
                                
                                <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors text-sm">
                                    Apply Filters
                                </button>
                                
                                <a href="{% url 'staff_dashboard' %}" class="block text-center w-full bg-gray-200 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors text-sm">
                                    Clear Filters
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="w-full md:w-3/4 px-4">
                <!-- Overview Tab -->
                <div id="overview" class="tab-content active">
                    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-6">Dashboard Overview</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mr-4">
                                        <i class="fas fa-envelope text-blue-600 text-xl"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Total Contacts</p>
                                        <p class="text-2xl font-bold text-gray-800">{{ stats.total_contacts }}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-green-50 border-l-4 border-green-500 rounded-lg p-4">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center mr-4">
                                        <i class="fas fa-graduation-cap text-green-600 text-xl"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Total Applications</p>
                                        <p class="text-2xl font-bold text-gray-800">{{ stats.total_applications }}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-50 border-l-4 border-yellow-500 rounded-lg p-4">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center mr-4">
                                        <i class="fas fa-credit-card text-yellow-600 text-xl"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Pending Payments</p>
                                        <p class="text-2xl font-bold text-gray-800">{{ stats.pending_payments }}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-purple-50 border-l-4 border-purple-500 rounded-lg p-4">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center mr-4">
                                        <i class="fas fa-check-circle text-purple-600 text-xl"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600">Completed Payments</p>
                                        <p class="text-2xl font-bold text-gray-800">{{ stats.completed_payments }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h2 class="text-xl font-bold text-gray-800 mb-6">Recent Activities</h2>
                        
                        <div class="space-y-4">
                            {% if applications %}
                                <div class="border-l-4 border-green-500 pl-4 py-2">
                                    <p class="text-sm text-gray-600">Recent Application</p>
                                    <p class="font-medium">{{ applications.0.first_name }} {{ applications.0.last_name }} - {{ applications.0.course.skill.job_title }}</p>
                                    <p class="text-xs text-gray-500">{{ applications.0.created_at|date:"M d, Y" }}</p>
                                </div>
                            {% endif %}
                            
                            {% if contacts %}
                                <div class="border-l-4 border-blue-500 pl-4 py-2">
                                    <p class="text-sm text-gray-600">Recent Contact</p>
                                    <p class="font-medium">{{ contacts.0.first_name }} {{ contacts.0.last_name }} - {{ contacts.0.email }}</p>
                                    <p class="text-xs text-gray-500">{{ contacts.0.created_at|date:"M d, Y" }}</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Contacts Tab -->
                <div id="contacts" class="tab-content">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-bold text-gray-800">Contact Submissions</h2>
                            <button id="export-contacts-pdf" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors flex items-center">
                                <i class="fas fa-file-pdf mr-2"></i> Export to PDF
                            </button>
                        </div>
                        
                        {% if contacts %}
                            <div class="overflow-x-auto" id="contactsTable">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        {% for contact in contacts_page %}
                                            <tr class="hover:bg-gray-50">
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm font-medium text-gray-900">{{ contact.first_name }} {{ contact.last_name }}</div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm text-gray-500">{{ contact.email }}</div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm text-gray-500">{{ contact.phone|default:"-" }}</div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm text-gray-500">{{ contact.created_at|date:"M d, Y" }}</div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                    <button class="view-message-btn text-blue-600 hover:text-blue-900" data-id="{{ contact.id }}" data-name="{{ contact.first_name }} {{ contact.last_name }}" data-email="{{ contact.email }}" data-phone="{{ contact.phone|default:'' }}" data-message="{{ contact.message }}" data-date="{{ contact.created_at|date:'M d, Y' }}">
                                                        View Message
                                                    </button>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Pagination for Contacts -->
                            <div class="flex justify-center mt-6">
                                <nav class="inline-flex rounded-md shadow">
                                    {% if contacts_page.has_previous %}
                                        <a href="?tab=contacts&page={{ contacts_page.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}" class="relative inline-flex items-center px-4 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                            <i class="fas fa-chevron-left"></i>
                                        </a>
                                    {% else %}
                                        <span class="relative inline-flex items-center px-4 py-2 rounded-l-md border border-gray-300 bg-gray-100 text-sm font-medium text-gray-500 cursor-not-allowed">
                                            <i class="fas fa-chevron-left"></i>
                                        </span>
                                    {% endif %}
                                    
                                    <span class="relative inline-flex items-center px-4 py-2 border-t border-b border-gray-300 bg-white text-sm font-medium text-gray-700">
                                        Page {{ contacts_page.number }} of {{ contacts_page.paginator.num_pages }}
                                    </span>
                                    
                                    {% if contacts_page.has_next %}
                                        <a href="?tab=contacts&page={{ contacts_page.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}" class="relative inline-flex items-center px-4 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                            <i class="fas fa-chevron-right"></i>
                                        </a>
                                    {% else %}
                                        <span class="relative inline-flex items-center px-4 py-2 rounded-r-md border border-gray-300 bg-gray-100 text-sm font-medium text-gray-500 cursor-not-allowed">
                                            <i class="fas fa-chevron-right"></i>
                                        </span>
                                    {% endif %}
                                </nav>
                            </div>
                        {% else %}
                            <div class="text-center py-8">
                                <p class="text-gray-500">No contact submissions found.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Applications Tab -->
                <div id="applications" class="tab-content">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-bold text-gray-800">Course Applications</h2>
                            <button id="export-applications-pdf" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors flex items-center">
                                <i class="fas fa-file-pdf mr-2"></i> Export to PDF
                            </button>
                        </div>
                        
                        {% if applications %}
                            <div class="overflow-x-auto" id="applicationsTable">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        {% for application in applications_page %}
                                            <tr class="hover:bg-gray-50">
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm font-medium text-gray-900">{{ application.first_name }} {{ application.last_name }}</div>
                                                    <div class="text-xs text-gray-500">{{ application.email }}</div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm text-gray-900">{{ application.course.skill.job_title }}</div>
                                                    <div class="text-xs text-gray-500">{{ application.course.get_course_type_display }}</div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm text-gray-900">₹ {{ application.amount }}</div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                                        {% if application.status == 'PAYMENT_COMPLETED' %}
                                                            bg-green-100 text-green-800
                                                        {% elif application.status == 'PAYMENT_PENDING' %}
                                                            bg-yellow-100 text-yellow-800
                                                        {% else %}
                                                            bg-gray-100 text-gray-800
                                                        {% endif %}">
                                                        {{ application.status }}
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm text-gray-500">{{ application.created_at|date:"M d, Y" }}</div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                    <button class="view-application-btn text-blue-600 hover:text-blue-900" 
                                                            data-id="{{ application.id }}"
                                                            data-name="{{ application.first_name }} {{ application.last_name }}"
                                                            data-email="{{ application.email }}"
                                                            data-phone="{{ application.phone }}"
                                                            data-course="{{ application.course.skill.job_title }}"
                                                            data-type="{{ application.course.get_course_type_display }}"
                                                            data-amount="{{ application.amount }}"
                                                            data-status="{{ application.status }}"
                                                            data-date="{{ application.created_at|date:'M d, Y' }}"
                                                            data-address="{{ application.address }}, {{ application.city }}, {{ application.state }} - {{ application.pincode }}">
                                                        View Details
                                                    </button>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Pagination for Applications -->
                            <div class="flex justify-center mt-6">
                                <nav class="inline-flex rounded-md shadow">
                                    {% if applications_page.has_previous %}
                                        <a href="?tab=applications&page={{ applications_page.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}" class="relative inline-flex items-center px-4 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                            <i class="fas fa-chevron-left"></i>
                                        </a>
                                    {% else %}
                                        <span class="relative inline-flex items-center px-4 py-2 rounded-l-md border border-gray-300 bg-gray-100 text-sm font-medium text-gray-500 cursor-not-allowed">
                                            <i class="fas fa-chevron-left"></i>
                                        </span>
                                    {% endif %}
                                    
                                    <span class="relative inline-flex items-center px-4 py-2 border-t border-b border-gray-300 bg-white text-sm font-medium text-gray-700">
                                        Page {{ applications_page.number }} of {{ applications_page.paginator.num_pages }}
                                    </span>
                                    
                                    {% if applications_page.has_next %}
                                        <a href="?tab=applications&page={{ applications_page.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}" class="relative inline-flex items-center px-4 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                            <i class="fas fa-chevron-right"></i>
                                        </a>
                                    {% else %}
                                        <span class="relative inline-flex items-center px-4 py-2 rounded-r-md border border-gray-300 bg-gray-100 text-sm font-medium text-gray-500 cursor-not-allowed">
                                            <i class="fas fa-chevron-right"></i>
                                        </span>
                                    {% endif %}
                                </nav>
                            </div>
                        {% else %}
                            <div class="text-center py-8">
                                <p class="text-gray-500">No course applications found.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Message Detail Modal -->
    <div id="messageModal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black opacity-50"></div>
        <div class="bg-white rounded-lg p-8 max-w-lg w-full mx-4 relative z-10">
            <button id="closeMessageModal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
                <i class="fas fa-times"></i>
            </button>
            
            <h3 class="text-xl font-bold text-gray-800 mb-4" id="modalName"></h3>
            
            <div class="mb-4">
                <p class="text-sm text-gray-500">Contact Information</p>
                <div class="flex space-x-4 mt-2">
                    <div class="flex items-center text-gray-600">
                        <i class="fas fa-envelope mr-2"></i>
                        <span id="modalEmail"></span>
                    </div>
                    <div class="flex items-center text-gray-600">
                        <i class="fas fa-phone mr-2"></i>
                        <span id="modalPhone">Not provided</span>
                    </div>
                </div>
            </div>
            
            <div class="mb-4">
                <p class="text-sm text-gray-500">Message</p>
                <div class="mt-2 p-4 bg-gray-50 rounded-lg">
                    <p id="modalMessage" class="text-gray-700"></p>
                </div>
            </div>
            
            <div class="text-right text-xs text-gray-500">
                Submitted on <span id="modalDate"></span>
            </div>
        </div>
    </div>
    
    <!-- Application Detail Modal -->
    <div id="applicationModal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black opacity-50"></div>
        <div class="bg-white rounded-lg p-8 max-w-lg w-full mx-4 relative z-10">
            <button id="closeApplicationModal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
                <i class="fas fa-times"></i>
            </button>
            
            <h3 class="text-xl font-bold text-gray-800 mb-4" id="appModalName"></h3>
            
            <div class="mb-4">
                <p class="text-sm text-gray-500">Contact Information</p>
                <div class="flex space-x-4 mt-2">
                    <div class="flex items-center text-gray-600">
                        <i class="fas fa-envelope mr-2"></i>
                        <span id="appModalEmail"></span>
                    </div>
                    <div class="flex items-center text-gray-600">
                        <i class="fas fa-phone mr-2"></i>
                        <span id="appModalPhone"></span>
                    </div>
                </div>
            </div>
            
            <div class="mb-4">
                <p class="text-sm text-gray-500">Course Details</p>
                <div class="mt-2 p-4 bg-gray-50 rounded-lg">
                    <div class="flex justify-between mb-2">
                        <span class="text-gray-600">Course:</span>
                        <span class="font-medium text-gray-800" id="appModalCourse"></span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="text-gray-600">Type:</span>
                        <span class="font-medium text-gray-800" id="appModalType"></span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="text-gray-600">Amount:</span>
                        <span class="font-medium text-gray-800" id="appModalAmount"></span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Status:</span>
                        <span class="font-medium" id="appModalStatus"></span>
                    </div>
                </div>
            </div>
            
            <div class="mb-4">
                <p class="text-sm text-gray-500">Address</p>
                <div class="mt-2 p-4 bg-gray-50 rounded-lg">
                    <p id="appModalAddress" class="text-gray-700"></p>
                </div>
            </div>
            
            <div class="text-right text-xs text-gray-500">
                Applied on <span id="appModalDate"></span>
            </div>
        </div>
    </div>

    {% include 'mriif/footer.html' %}
    
    <script>
        window.jsPDF = window.jspdf.jsPDF;
        
        $(document).ready(function() {
            // Get the tab from URL query parameter
            const urlParams = new URLSearchParams(window.location.search);
            const tabParam = urlParams.get('tab');
            
            // Check if URL has tab parameter
            if (tabParam) {
                $('.tab-content').removeClass('active');
                $('#' + tabParam).addClass('active');
                
                // Add active styling to tab button
                $('.tab-btn').removeClass('bg-blue-100 text-blue-600');
                $('.tab-btn[data-tab="' + tabParam + '"]').addClass('bg-blue-100 text-blue-600');
            } else {
                // Initialize the first tab if no parameter
                $('.tab-btn[data-tab="overview"]').addClass('bg-blue-100 text-blue-600');
            }
            
            // Tab functionality
            $('.tab-btn').click(function() {
                const tabId = $(this).data('tab');
                $('.tab-content').removeClass('active');
                $('#' + tabId).addClass('active');
                
                // Add active styling to tab button
                $('.tab-btn').removeClass('bg-blue-100 text-blue-600');
                $(this).addClass('bg-blue-100 text-blue-600');
                
                // Update URL without refreshing the page
                const url = new URL(window.location);
                url.searchParams.set('tab', tabId);
                window.history.pushState({}, '', url);
            });
            
            // Contact message modal functionality
            $('.view-message-btn').click(function() {
                const id = $(this).data('id');
                const name = $(this).data('name');
                const email = $(this).data('email');
                const phone = $(this).data('phone') || 'Not provided';
                const message = $(this).data('message');
                const date = $(this).data('date');
                
                $('#modalName').text(name);
                $('#modalEmail').text(email);
                $('#modalPhone').text(phone);
                $('#modalMessage').text(message);
                $('#modalDate').text(date);
                
                $('#messageModal').removeClass('hidden');
            });
            
            $('#closeMessageModal').click(function() {
                $('#messageModal').addClass('hidden');
            });
            
            // Application details modal functionality
            $('.view-application-btn').click(function() {
                const id = $(this).data('id');
                const name = $(this).data('name');
                const email = $(this).data('email');
                const phone = $(this).data('phone');
                const course = $(this).data('course');
                const type = $(this).data('type');
                const amount = $(this).data('amount');
                const status = $(this).data('status');
                const date = $(this).data('date');
                const address = $(this).data('address');
                
                $('#appModalName').text(name);
                $('#appModalEmail').text(email);
                $('#appModalPhone').text(phone);
                $('#appModalCourse').text(course);
                $('#appModalType').text(type);
                $('#appModalAmount').text('₹ ' + amount);
                
                const statusElement = $('#appModalStatus');
                statusElement.text(status);
                
                if (status === 'PAYMENT_COMPLETED') {
                    statusElement.removeClass('text-yellow-600 text-red-600').addClass('text-green-600');
                } else if (status === 'PAYMENT_PENDING') {
                    statusElement.removeClass('text-green-600 text-red-600').addClass('text-yellow-600');
                } else {
                    statusElement.removeClass('text-green-600 text-yellow-600').addClass('text-red-600');
                }
                
                $('#appModalAddress').text(address);
                $('#appModalDate').text(date);
                
                $('#applicationModal').removeClass('hidden');
            });
            
            $('#closeApplicationModal').click(function() {
                $('#applicationModal').addClass('hidden');
            });
            
            // Close modals when clicking outside of them
            $(window).click(function(event) {
                if ($(event.target).is('#messageModal') || $(event.target).is('#applicationModal')) {
                    $('#messageModal, #applicationModal').addClass('hidden');
                }
            });
            
            // Export contacts to PDF
            $('#export-contacts-pdf').click(function() {
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(18);
                doc.setTextColor(40, 40, 40);
                doc.text("Contact Submissions Report", 105, 15, { align: "center" });
                
                // Add date
                doc.setFontSize(10);
                doc.setTextColor(80, 80, 80);
                const today = new Date();
                doc.text("Generated on: " + today.toLocaleDateString(), 105, 22, { align: "center" });
                
                // Create table data
                const tableColumn = ["Name", "Email", "Phone", "Date"];
                const tableRows = [];
                
                // Get all contacts across all pages for the PDF
                {% for contact in all_contacts %}
                    tableRows.push([
                        "{{ contact.first_name }} {{ contact.last_name }}",
                        "{{ contact.email }}",
                        "{{ contact.phone|default:'-' }}",
                        "{{ contact.created_at|date:'M d, Y' }}"
                    ]);
                {% endfor %}
                
                // Generate table
                doc.autoTable({
                    head: [tableColumn],
                    body: tableRows,
                    startY: 30,
                    headStyles: {
                        fillColor: [66, 139, 202],
                        textColor: 255
                    },
                    alternateRowStyles: {
                        fillColor: [240, 240, 240]
                    },
                    margin: { top: 30 }
                });
                
                // Save PDF
                doc.save("contact-submissions.pdf");
            });
            
            // Export applications to PDF
            $('#export-applications-pdf').click(function() {
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(18);
                doc.setTextColor(40, 40, 40);
                doc.text("Course Applications Report", 105, 15, { align: "center" });
                
                // Add date
                doc.setFontSize(10);
                doc.setTextColor(80, 80, 80);
                const today = new Date();
                doc.text("Generated on: " + today.toLocaleDateString(), 105, 22, { align: "center" });
                
                // Create table data
                const tableColumn = ["Name", "Course", "Amount", "Status", "Date"];
                const tableRows = [];
                
                // Get all applications across all pages for the PDF
                {% for application in all_applications %}
                    tableRows.push([
                        "{{ application.first_name }} {{ application.last_name }}",
                        "{{ application.course.skill.job_title }}",
                        "₹ {{ application.amount }}",
                        "{{ application.status }}",
                        "{{ application.created_at|date:'M d, Y' }}"
                    ]);
                {% endfor %}
                
                // Generate table
                doc.autoTable({
                    head: [tableColumn],
                    body: tableRows,
                    startY: 30,
                    headStyles: {
                        fillColor: [46, 125, 50],
                        textColor: 255
                    },
                    alternateRowStyles: {
                        fillColor: [240, 240, 240]
                    },
                    margin: { top: 30 }
                });
                
                // Save PDF
                doc.save("course-applications.pdf");
            });
        });
    </script>
</body>
</html>
